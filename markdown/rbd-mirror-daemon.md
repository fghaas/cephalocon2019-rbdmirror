<!-- .slide: data-timing="15" -->
# The `rbd-mirror` daemon

<!-- Note -->
`rbd-mirror`, now, is a daemon that

* **watches** journal updates in journal-enabled RBDs,
* **replays** the journal in the cluster that it runs in.

So what does that mean?


<!-- .slide: data-background-image="images/watch.svg" data-background-size="contain" data-timing="20" -->
## Watch journal updates <!-- .element: class="hidden" -->

<!-- Note --> 
Here, we have two Ceph clusters, which I’ve named `left` and
`right`. Both Ceph clusters have an RBD image named `replicated` in a
pool named `rbd`.

Now when properly configured, an `rbd-mirror` daemon on the `right`
cluster is responsible for subscribing to journal updates generated by
the `rbd/replicated` image in the `left` cluster (this is called
**watching** the journal).


<!-- .slide: data-background-image="images/replay.svg" data-background-size="contain" data-timing="20" -->
## Replay journal updates <!-- .element: class="hidden" -->

<!-- Note --> 
It then takes these journal updates, and applies them,
chronologically, to a volume that is also named `rbd/replicated`,
albeit in the `right` cluster (this is called **replaying** the journal).

And in this configuration, the `rbd/replicated` image on `left` is
known as the **primary** image, whereas the one on `right` is called
the **non-primary** image.


<!-- .slide: data-background-image="images/multiple-non-primary.svg" data-background-size="contain" -->
## Primary vs. non-primary <!-- .element: class="hidden" -->

<!-- Note --> 
It should be noted that we can also have *multiple non-primary*
images. This means that multiple `rbd-mirror` daemons (in multiple
clusters) can watch the same image journal, and replay it
locally. Thus we can, say, replicate from one primary to two or three
non-primary sites. But, in doing so, every site needs its own
`rbd-mirror`.

What we **cannot** do, in the configuration as shown, is reverse the
direction of replication, for the simple reason that the `left` site
doesn’t have an `rbd-mirror` of its own. 

This mode is called **one-way** mirroring, and to be able to reverse
the replication, we need **two-way mirroring**.
